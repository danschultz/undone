        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Transaction class / undone Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="undone" data-type="Transaction">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../undone.html">undone</a> &rsaquo; <a href="../undone/Transaction.html">Transaction</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>Transaction</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>A sequence of actions that are done and undone together as if one action.</p>
<p>A transaction is itself an action that may be <code>call</code>ed on a schedule.
When a transaction is scheduled to be done or undone it will do or undo
all of its actions in sequence.  Any errors that occur when doing one of
its actions will cause the transaction to attempt to undo all of its actions
that were done prior to the error; this is known as rollback.  These errors
will be wrapped in a <a class="crossref" href="../undone/TransactionError.html">TransactionError</a> and completed to the caller.</p>
<pre class="source">
class Transaction extends Action {
 
 static Future _do_(List&lt;Action&gt; actions) {
   var completer = new Completer&lt;List&gt;();            
   var current;
   // Try to do all the actions in order.
   Future.forEach(actions, (action) {
     // Keep track of the current action in case an error happens.
     current = action;
     return action._execute();
   }).then((_) =&gt; completer.complete())
     .catchError((e) {
       final err = new TransactionError(e);
       final reverse = actions.reversed.skipWhile((e) =&gt; e == current);
       // Try to undo from the point of failure back to the start.
       Future.forEach(reverse, (action) =&gt; action._unexecute())
         // We complete with error even if rollback succeeds.
         .then((_) =&gt; completer.completeError(err))
         .catchError((e) { 
           // Double trouble, give both errors to the caller.
           err._rollbackError = e;
           completer.completeError(err);
         });
     });
   return completer.future;
 }
 
 static Future _undo_(List&lt;Action&gt; actions, _) =&gt; 
     Future.forEach(actions.reversed, (action) =&gt; action._unexecute());
 
 /// Constructs a new empty transaction.
 Transaction() : super._(new List&lt;Action&gt;(), _do_, _undo_);
 
 /// Adds the given [action] to this transaction.
 void add(Action action) =&gt; _arg.add(action);
}
</pre>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../undone/Action.html">Action</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>Transaction</strong></span></p>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="Transaction">
<button class="show-code">Code</button>
new <strong>Transaction</strong>() <a class="anchor-link" href="#Transaction"
              title="Permalink to Transaction.Transaction">#</a></h4>
<div class="doc">
<p>Constructs a new empty transaction.</p>
<pre class="source">
Transaction() : super._(new List&lt;Action&gt;(), _do_, _undo_);
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="add">
<button class="show-code">Code</button>
void <strong>add</strong>(<a href="../undone/Action.html">Action</a> action) <a class="anchor-link" href="#add"
              title="Permalink to Transaction.add">#</a></h4>
<div class="doc">
<p>Adds the given 
<span class="param">action</span> to this transaction.</p>
<pre class="source">
void add(Action action) =&gt; _arg.add(action);
</pre>
</div>
</div>
<div class="method inherited"><h4 id="call">
<button class="show-code">Code</button>
Future&lt;<a href="../undone/Transaction.html">R</a>&gt; <strong>call</strong>() <a class="anchor-link" href="#call"
              title="Permalink to Transaction.call">#</a></h4>
<div class="inherited-from">inherited from <a href="../undone/Action.html">Action</a> </div><div class="doc">
<p>Schedules this action to be called on the top-level <a class="crossref" href="../undone.html#schedule">schedule</a>.  If this
action is called within the scope of a top-level <a class="crossref" href="../undone.html#transact">transact</a> method it will
instead be added to that transaction.  Completes with the result of the
action in both cases.</p>
<pre class="source">
Future&lt;R&gt; call() {    
 if (_transaction != null) {
   _transaction.add(this);
   return this._defer();
 }
 return schedule(this);
}
</pre>
</div>
</div>
<div class="method inherited"><h4 id="toString">
<button class="show-code">Code</button>
String <strong>toString</strong>() <a class="anchor-link" href="#toString"
              title="Permalink to Transaction.toString">#</a></h4>
<div class="inherited-from">inherited from <a href="../undone/Action.html">Action</a> </div><div class="doc">
<div class="inherited">
<p>Returns a string representation of this object.</p>
<div class="docs-inherited-from">docs inherited from Object </div></div>
<pre class="source">
String toString() =&gt; 'action($hashCode)';
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-03-28 00:40:40.615</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
